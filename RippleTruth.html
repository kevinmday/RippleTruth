<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RippleTruth — Prototype Analyzer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0f14; --panel:#10161d; --muted:#96a2b4; --text:#e6edf6; --acc:#57b2ff; --acc2:#c3ff5a; --warn:#ffb857; --danger:#ff6b6b; --ok:#57ffb2;
      --ring:#1e2a36; --card:#0d141b; --shadow:0 8px 28px rgba(0,0,0,.45);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif; background:linear-gradient(135deg,#0b0f14,#0a0d12 40%, #0a1017); color:var(--text)}
    .wrap{display:grid; grid-template-columns:420px 1fr; gap:22px; max-width:1400px; padding:22px; margin:0 auto}
    .panel{background:var(--panel); border:1px solid #17202a; border-radius:18px; padding:18px; box-shadow:var(--shadow)}
    .panel h2{margin:6px 0 14px; font-size:18px; letter-spacing:.3px}
    label{display:block; font-size:12px; color:var(--muted); margin:12px 0 6px}
    textarea, input[type=text]{width:100%; background:#0b1118; color:var(--text); border:1px solid #1a2430; border-radius:12px; padding:12px 12px; outline:none}
    textarea{min-height:160px; resize:vertical}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    .btn{appearance:none; border:none; background:linear-gradient(180deg,#1b2734,#121a22); color:var(--text); padding:12px 14px; border-radius:12px; cursor:pointer; border:1px solid #1e2a36; font-weight:600}
    .btn:hover{filter:brightness(1.05)}
    .btn.primary{background:linear-gradient(180deg,#1b2f44,#152436); border-color:#233447; box-shadow:0 0 0 1px rgba(87,178,255,.15) inset}
    .btn.ghost{background:transparent; border-color:#223144}
    .small{font-size:12px; color:var(--muted)}
    .slider{width:100%}
    .grid2{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:18px}
    .grid3{display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:14px}

    /* Card */
    .card{background:radial-gradient(1100px 400px at 90% -20%, rgba(87,178,255,.08), transparent),
           radial-gradient(800px 300px at -10% 120%, rgba(195,255,90,.06), transparent), var(--card);
          border:1px solid #15202b; border-radius:22px; padding:20px; box-shadow:var(--shadow);}
    .card-header{display:flex; align-items:center; gap:14px; margin-bottom:12px}
    .badge{padding:6px 10px; border-radius:999px; font-size:11px; color:#091118; font-weight:700; letter-spacing:.3px; background:linear-gradient(180deg,#7fd2ff,#57b2ff);}
    .hz{margin-left:auto; font-size:12px; color:var(--muted)}
    .metrics{display:grid; grid-template-columns:180px 1fr; gap:22px; align-items:center}

    /* Rings */
    .rings{display:grid; grid-template-columns:repeat(2,100px); gap:14px}
    .ring{position:relative; width:100px; height:100px}
    .ring svg{transform:rotate(-90deg)}
    .ring .label{position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-weight:700}
    .legend{display:grid; gap:6px; font-size:13px}
    .lg-row{display:flex; align-items:center; gap:10px}
    .dot{width:10px; height:10px; border-radius:50%}

    .vectors{margin-top:12px; display:grid; gap:10px}
    .vector{display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border:1px solid #1a2430; border-radius:12px; background:#0a1117}
    .vector .bar{height:7px; background:linear-gradient(90deg,#203040,#2a4f7a); border-radius:6px; overflow:hidden; width:44%}
    .vector .bar span{display:block; height:100%; background:linear-gradient(90deg,#57b2ff,#c3ff5a)}

    .narr{margin-top:14px; font-size:14px; line-height:1.5; color:#d2dae5}
    .footer{display:flex; gap:10px; margin-top:16px}
    .muted{color:var(--muted)}
    .pill{padding:6px 10px; border-radius:999px; border:1px solid #243246; color:var(--muted); font-size:12px}

    @media (max-width:1100px){.wrap{grid-template-columns:1fr;}}
  </style>
</head>
<body>
  <div class="wrap">

    <section class="panel" id="inputPanel">
      <h2>RippleTruth — Input</h2>
      <label for="text">Paste text to analyze</label>
      <textarea id="text" placeholder="Paste speech, statement, article excerpt, or your own notes..."></textarea>

      <div class="row">
        <div>
          <label for="url">or fetch a URL (MVP stub)</label>
          <input type="text" id="url" placeholder="https://example.com/article"/>
        </div>
        <div>
          <label for="horizon">Horizon (days): <span id="horizonVal" class="small">14</span></label>
          <input type="range" id="horizon" class="slider" min="3" max="60" value="14" />
        </div>
      </div>

      <h2 style="margin-top:16px">Weights</h2>
      <div class="grid2">
        <div>
          <label>Coherence weight <span id="wCoVal" class="small">0.35</span></label>
          <input type="range" id="wCo" class="slider" min="0" max="1" step="0.01" value="0.35" />
        </div>
        <div>
          <label>Directive intent <span id="wDiVal" class="small">0.30</span></label>
          <input type="range" id="wDi" class="slider" min="0" max="1" step="0.01" value="0.30" />
        </div>
        <div>
          <label>Counterforce gap <span id="wCgVal" class="small">0.20</span></label>
          <input type="range" id="wCg" class="slider" min="0" max="1" step="0.01" value="0.20" />
        </div>
        <div>
          <label>Volatility <span id="wVoVal" class="small">0.15</span></label>
          <input type="range" id="wVo" class="slider" min="0" max="1" step="0.01" value="0.15" />
        </div>
      </div>

      <div style="display:flex; gap:10px; margin-top:16px">
        <button class="btn primary" id="analyzeBtn">Analyze</button>
        <button class="btn ghost" id="demoBtn">Load demo</button>
        <span class="small" id="status"></span>
      </div>
    </section>

    <section class="card" id="card">
      <div class="card-header">
        <div class="badge">RippleTruth Card</div>
        <div class="pill" id="bandPill">Dominant Frequency: —</div>
        <div class="hz" id="hz">— Hz</div>
      </div>

      <div class="metrics">
        <div class="rings">
          <!-- UCIP -->
          <div class="ring">
            <svg width="100" height="100" viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="44" stroke="var(--ring)" stroke-width="10" fill="none"/>
              <circle id="ucipRing" cx="50" cy="50" r="44" stroke="url(#grad1)" stroke-width="10" stroke-linecap="round" fill="none" stroke-dasharray="276" stroke-dashoffset="276"/>
              <defs>
                <linearGradient id="grad1" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0%" stop-color="#57b2ff"/>
                  <stop offset="100%" stop-color="#c3ff5a"/>
                </linearGradient>
              </defs>
            </svg>
            <div class="label"><span id="ucipVal">UCIP — 0.00</span></div>
          </div>
          <!-- FILS -->
          <div class="ring">
            <svg width="100" height="100" viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="44" stroke="var(--ring)" stroke-width="10" fill="none"/>
              <circle id="filsRing" cx="50" cy="50" r="44" stroke="url(#grad1)" stroke-width="10" stroke-linecap="round" fill="none" stroke-dasharray="276" stroke-dashoffset="276"/>
            </svg>
            <div class="label"><span id="filsVal">FILS — 0.00</span></div>
          </div>
          <!-- TTCF -->
          <div class="ring">
            <svg width="100" height="100" viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="44" stroke="var(--ring)" stroke-width="10" fill="none"/>
              <circle id="ttcfRing" cx="50" cy="50" r="44" stroke="#ff6b6b" stroke-width="10" stroke-linecap="round" fill="none" stroke-dasharray="276" stroke-dashoffset="276"/>
            </svg>
            <div class="label"><span id="ttcfVal">TTCF — 0.00</span></div>
          </div>
          <!-- Confidence / Clarity -->
          <div class="ring">
            <svg width="100" height="100" viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="44" stroke="var(--ring)" stroke-width="10" fill="none"/>
              <circle id="clarRing" cx="50" cy="50" r="44" stroke="#7cffc2" stroke-width="10" stroke-linecap="round" fill="none" stroke-dasharray="276" stroke-dashoffset="276"/>
            </svg>
            <div class="label"><span id="clarVal">Clarity — 0.00</span></div>
          </div>
        </div>

        <div class="legend">
          <div class="lg-row"><div class="dot" style="background:#57b2ff"></div><div>UCIP — Unified Coherence of Intention Pattern</div></div>
          <div class="lg-row"><div class="dot" style="background:#c3ff5a"></div><div>FILS — Probability of Manifestation (horizon)</div></div>
          <div class="lg-row"><div class="dot" style="background:#ff6b6b"></div><div>TTCF — Entropy from rhetoric ↔ reality gap</div></div>
          <div class="lg-row"><div class="dot" style="background:#7cffc2"></div><div>Clarity — linguistic focus / purpose</div></div>
          <div class="small muted">Weights and horizon shape these scores. This MVP uses lightweight client-side heuristics for demo purposes.</div>
        </div>
      </div>

      <div class="vectors" id="vectors"></div>

      <div class="narr" id="narrative">Paste text and click Analyze to generate a RippleTruth card. You’ll see coherence, likelihood, and entropy readings with a short narrative interpretation.</div>

      <div class="footer">
        <button class="btn" id="explainBtn">Why these scores?</button>
        <button class="btn ghost" id="copyBtn">Copy JSON</button>
        <span class="small muted" id="explain"></span>
      </div>
    </section>

  </div>

  <script>
    const $ = (s)=>document.querySelector(s);
    const L = (id,val)=>{$(id).textContent = val};
    const P = (v)=>Math.max(0,Math.min(1,v));

    const imperativeWords = ['must','will','shall','do it','go','deploy','strike','ban','prohibit','authorize','order','kill','attack','seize','announce','demand'];
    const counterforceWords = ['congress','oversight','court','hearing','vote','audit','press','media','ngo','treaty','alliance'];
    const volatilityHints = ['!','ALL CAPS','??','***'];

    function scoreHeuristics(text, weights, horizon){
      const raw = text || '';
      const t = raw.replace(/\s+/g,' ').trim();
      const words = t.toLowerCase();
      const len = t.length || 1;

      // Directive intent: imperative density
      let dir = 0;
      imperativeWords.forEach(w=>{ if(words.includes(w)) dir += 1; });
      dir = Math.min(1, dir/8);

      // Coherence: penalize topic jumps (naive: commas + semicolons + parenthesis) and reward repeated key terms
      const commas = (t.match(/[,;:]/g)||[]).length;
      const parens = (t.match(/[()]/g)||[]).length;
      const repeats = (t.match(/\b([a-z]{5,})\b(?=.*\b\1\b)/gi)||[]).length; // repeated tokens
      let coherence = P(0.4 + (repeats/20) - ((commas+parens)/60));

      // Counterforce gap: presence of balancing institutions lowers the gap
      let cf = 0; counterforceWords.forEach(w=>{ if(words.includes(w)) cf += 1; });
      const counterforcePresence = Math.min(1, cf/6);
      const counterforceGap = P(1 - counterforcePresence);

      // Volatility: exclamations, all-caps ratio, sentiment spikes (very naive)
      const excls = (t.match(/!/g)||[]).length;
      const uppers = (t.match(/[A-Z]/g)||[]).length;
      const ratio = uppers / len;
      let volatility = P( (excls/8) + (ratio>0.18? (ratio-0.18)*2 : 0) );

      // Clarity: inverse of hedging terms
      const hedges = ['maybe','perhaps','might','could','somewhat','sort of','i think','we hope'];
      let hedge = 0; hedges.forEach(h=>{ if(words.includes(h)) hedge += 1; });
      let clarity = P(0.8 - hedge*0.12 + dir*0.1 + coherence*0.1);

      // Dominant frequency: map mode to bands
      let freq = 10; // neutral alpha
      if(dir>0.6 && volatility<0.4) freq = 16.5; // assertive
      if(dir>0.6 && volatility>=0.4) freq = 19.2; // high beta, will-to-action
      if(coherence<0.4 && volatility>0.5) freq = 6.8; // theta drift
      if(words.includes('congress') && words.includes('won\'t call')) freq = 7.8; // illustrative hook

      // Aggregate metrics
      const w = weights;
      const UCIP = P( w.co*coherence + 0.25*clarity + 0.15*(1 - volatility) + 0.2*(1 - counterforceGap) + 0.1*dir );
      const FILS = P( w.di*dir + 0.25*clarity + 0.25*coherence + 0.2*(1 - counterforceGap) - 0.15*volatility + (horizon>21? -0.05: 0) );
      const TTCF = P( 0.6*volatility + 0.3*counterforceGap + 0.1*(1 - coherence) );

      const band = freq<7.5 ? 'Theta — drift' : (freq<10 ? 'Low Alpha — passivity' : (freq<15 ? 'Alpha — steady' : (freq<20 ? 'Beta — assertive' : 'High Beta — acute')));

      // Vectors for UI
      const vectors = [
        {name:'Foundational Intention', val:P(0.5+dir*0.4+coherence*0.2 - volatility*0.1), note: dir>0.6? 'Directive/kinetic' : 'Mixed/ambiguous'},
        {name:'Counterforce', val:counterforcePresence, note: counterforcePresence>0.5? 'Balancing present' : 'Weak checks'},
        {name:'Volatility', val:volatility, note: volatility>0.5? 'High turbulence' : 'Contained'},
        {name:'Clarity', val:clarity, note: clarity>0.6? 'Focused' : 'Hedged'}
      ];

      const narrative = composeNarrative({UCIP,FILS,TTCF,dir,coherence,volatility,counterforcePresence,freq,band});

      return {UCIP,FILS,TTCF,clarity,dir,coherence,volatility,counterforcePresence,freq,band,vectors,narrative};
    }

    function composeNarrative(m){
      const tone = m.freq>=15? 'assertive signal' : (m.freq<8? 'low-energy field' : 'stable but subdued field');
      const risk = m.TTCF>0.65? 'high entropy; words likely to outrun reality' : (m.TTCF>0.45? 'moderate entropy' : 'contained entropy');
      const lik = m.FILS>0.7? 'high likelihood of near-term manifestation' : (m.FILS>0.5? 'plausible materialization window' : 'low conversion probability');
      const cf  = m.counterforcePresence<0.4? 'weak counterforces' : 'visible checks and balances';
      return `Signal reads as a ${tone}. Coherence at ${pct(m.UCIP)} with ${risk}. ${lik} within the selected horizon, shaped by ${cf}. Volatility ${pct(m.volatility)}; clarity ${pct(m.clarity)}.`;
    }

    function pct(v){ return Math.round(v*100)+'%'; }
    function setRing(el, v){
      const C = 2*Math.PI*44; const off = C*(1 - v);
      el.style.strokeDashoffset = off;
    }

    function render(res){
      setRing($('#ucipRing'), res.UCIP);
      setRing($('#filsRing'), res.FILS);
      setRing($('#ttcfRing'), res.TTCF);
      setRing($('#clarRing'), res.clarity);

      L('#ucipVal', `UCIP — ${res.UCIP.toFixed(2)}`);
      L('#filsVal', `FILS — ${res.FILS.toFixed(2)}`);
      L('#ttcfVal', `TTCF — ${res.TTCF.toFixed(2)}`);
      L('#clarVal', `Clarity — ${res.clarity.toFixed(2)}`);
      L('#hz', `${res.freq.toFixed(1)} Hz`);
      L('#bandPill', `Dominant Frequency: ${res.band}`);

      const vecWrap = $('#vectors');
      vecWrap.innerHTML = '';
      res.vectors.forEach(v=>{
        const row = document.createElement('div');
        row.className = 'vector';
        row.innerHTML = `<div><strong>${v.name}</strong><div class="small muted">${v.note}</div></div>
                         <div class="bar"><span style="width:${pct(v.val)}"></span></div>
                         <div>${pct(v.val)}</div>`;
        vecWrap.appendChild(row);
      });

      $('#narrative').textContent = res.narrative;
      $('#explain').textContent = 'MVP demo uses client‑side heuristics (imperatives, hedging, volatility, counterforce mentions). Backend model would replace this logic.';
    }

    function getWeights(){
      return { co: +$('#wCo').value, di: +$('#wDi').value, cg: +$('#wCg').value, vo: +$('#wVo').value };
    }

    // UI bindings
    $('#horizon').addEventListener('input', e=> L('#horizonVal', e.target.value));
    [['#wCo','#wCoVal'],['#wDi','#wDiVal'],['#wCg','#wCgVal'],['#wVo','#wVoVal']].forEach(([a,b])=>{
      $(a).addEventListener('input', e=> L(b, (+e.target.value).toFixed(2)));
    });

    $('#demoBtn').addEventListener('click', ()=>{
      $('#text').value = `The land is going to be next. We will strike cartel infrastructure and end the threat. Congress has been notified. We will act. We will win. Do not get in the way.`;
      $('#status').textContent = 'Loaded demo sample.';
    });

    $('#analyzeBtn').addEventListener('click', ()=>{
      const txt = $('#text').value.trim();
      if(!txt){ $('#status').textContent = 'Enter text or load demo first.'; return; }
      $('#status').textContent = 'Analyzing…';
      const res = scoreHeuristics(txt, getWeights(), +$('#horizon').value);
      render(res);
      window.__last = res;
      $('#status').textContent = 'Done.';
    });

    $('#copyBtn').addEventListener('click', ()=>{
      const res = window.__last || {};
      const payload = {
        metrics:{ UCIP:res.UCIP, FILS:res.FILS, TTCF:res.TTCF, dominant_frequency_hz:res.freq },
        bands: res.band, vectors: res.vectors, narrative: res.narrative
      };
      navigator.clipboard.writeText(JSON.stringify(payload, null, 2));
      $('#status').textContent = 'JSON copied to clipboard.';
    });
  </script>
</body>
</html>
